<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¬æ¯é‡å¯ | Bridge to Reality</title>
    <link rel="icon" href="https://fav.farm/ğŸƒ" />
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;500&family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        :root { --theme-primary: #334155; --theme-bg: #f8fafc; }
        body { font-family: 'Inter', 'Noto Serif SC', serif; background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%); min-height: 100vh; transition: background 1.5s ease; overflow-x: hidden; }
        .glass-panel { background: rgba(255, 255, 255, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.8); border-radius: 32px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.03); }
        .persona-card { transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); border: 2px solid transparent; background: rgba(255, 255, 255, 0.3); }
        .persona-card.active { background: white; border-color: var(--theme-color, #334155); box-shadow: 0 10px 30px -10px rgba(0,0,0,0.1); transform: translateY(-2px); }
        .mood-slider { -webkit-appearance: none; width: 100%; height: 6px; background: linear-gradient(to right, #94a3b8, #475569, #ef4444); border-radius: 10px; cursor: pointer; }
        .mood-slider::-webkit-slider-thumb { -webkit-appearance: none; width: 24px; height: 24px; background: #fff; border: 2px solid var(--theme-color, #334155); border-radius: 50%; box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .chat-container { border: 1px solid rgba(0, 0, 0, 0.08); }
        .typing-indicator { display: flex; gap: 4px; padding: 12px 20px; background: rgba(0,0,0,0.03); border-radius: 1.5rem; width: fit-content; margin-bottom: 1rem; }
        .typing-dot { width: 5px; height: 5px; background: #94a3b8; border-radius: 50%; animation: typingBounce 1.4s infinite ease-in-out both; }
        @keyframes typingBounce { 0%, 80%, 100% { transform: scale(0); opacity: 0.3; } 40% { transform: scale(1); opacity: 1; } }
        #sticky-note-container { display: flex; overflow-x: auto; padding: 20px 0; gap: 20px; }
        .sticky-note { background: #fff; padding: 1.5rem; border-left: 6px solid var(--note-color, #334155); width: 280px; flex-shrink: 0; box-shadow: 5px 5px 15px rgba(0,0,0,0.05); }
    </style>
</head>
<body class="p-4 md:p-8 flex flex-col items-center pb-24">
    <header class="w-full max-w-2xl text-center mt-6 mb-12 z-10">
        <div id="time" class="text-7xl font-extralight tracking-tighter text-slate-800 mb-2">00:00</div>
        <div id="weatherBox" class="flex items-center justify-center space-x-3 text-[10px] font-bold tracking-[0.2em] text-slate-400 uppercase">
            <span id="date">----.--.--</span> | <span><i data-lucide="map-pin" class="inline w-3 h-3"></i> <span id="location">å®šä½ä¸­...</span></span> | <span id="weatherInfo">æ„Ÿåº”ä¸­...</span>
        </div>
    </header>

    <main class="w-full max-w-2xl space-y-6 z-10">
        <section class="glass-panel p-8">
            <div class="grid grid-cols-2 gap-4">
                <button onclick="selectPersona('weiguang')" id="p-weiguang" class="persona-card p-5 rounded-3xl text-left">â˜ï¸ <strong>å¾®å…‰</strong><p class="text-[10px] text-slate-400">æ¸©æŸ”é™ªä¼´</p></button>
                <button onclick="selectPersona('kongshan')" id="p-kongshan" class="persona-card p-5 rounded-3xl text-left">ğŸƒ <strong>ç©ºå±±</strong><p class="text-[10px] text-slate-400">æ¶ˆé™¤å™ªéŸ³</p></button>
                <button onclick="selectPersona('lingjing')" id="p-lingjing" class="persona-card p-5 rounded-3xl text-left">ğŸ’  <strong>æ£±é•œ</strong><p class="text-[10px] text-slate-400">è„‘ç§‘æ‹†è§£</p></button>
                <button onclick="selectPersona('huohua')" id="p-huohua" class="persona-card p-5 rounded-3xl text-left">ğŸ”¥ <strong>ç«èŠ±</strong><p class="text-[10px] text-slate-400">è¡ŒåŠ¨æ¨åŠ›</p></button>
            </div>
        </section>

        <section id="chat-section" class="glass-panel chat-container flex flex-col h-[380px] overflow-hidden bg-white/50 relative">
            <div id="chat" class="flex-1 overflow-y-auto p-8 space-y-4 text-sm flex flex-col"></div>
            <div class="p-4 border-t flex items-center space-x-2">
                <textarea id="input" rows="1" class="flex-1 p-3 border rounded-xl resize-none focus:outline-none" placeholder="èŠèŠå§..."></textarea>
                <button id="send" disabled class="p-3 bg-slate-700 text-white rounded-xl">å‘é€</button>
            </div>
        </section>

        <button id="btn-start-reboot" class="w-full py-6 rounded-3xl bg-slate-700 text-white font-bold shadow-xl">ç”Ÿæˆé‡å¯æŒ‡ä»¤</button>

        <section id="section-stage-1" class="hidden glass-panel p-8 text-center space-y-4">
            <div id="display-break-instruction" class="text-xl font-medium"></div>
            <button id="btn-confirm-break" class="w-full py-4 bg-slate-800 text-white rounded-2xl">æˆ‘å·²å®Œæˆ</button>
        </section>
    </main>

    <script>
        // ã€å…³é”®ã€‘è¯·åœ¨è¿™é‡Œå¡«å…¥ä½ æ–°ç”³è¯·çš„ API Key
        const apiKey = "AIzaSyA6k2Ozjd8xckqALkJ-OeVXJAbda2oGgQ8"; 

        const personas = {
            weiguang: { name: "å¾®å…‰", theme: "#fbbf24", bg: "#fffcf0", systemPrompt: "ä½ å«å¾®å…‰ã€‚è¯­æ°”æ¸©æŸ”èˆ’ç¼“ã€‚", welcome: "æˆ‘æ˜¯å¾®å…‰ã€‚å“ªé‡Œè®©ä½ è§‰å¾—ä¸èˆ’æœï¼Ÿ" },
            kongshan: { name: "ç©ºå±±", theme: "#34d399", bg: "#f0fdf4", systemPrompt: "ä½ å«ç©ºå±±ã€‚æç®€å†·é™ã€‚", welcome: "æˆ‘æ˜¯ç©ºå±±ã€‚è¯´è¯´å¤§è„‘é‡Œçš„å™ªéŸ³ã€‚" },
            lingjing: { name: "æ£±é•œ", theme: "#38bdf8", bg: "#f0f9ff", systemPrompt: "ä½ å«æ£±é•œã€‚ç†æ€§åˆ†æã€‚", welcome: "æˆ‘æ˜¯æ£±é•œã€‚æˆ‘ä»¬æ¥æ‹†è§£ä½ çš„æƒ…ç»ªã€‚" },
            huohua: { name: "ç«èŠ±", theme: "#f87171", bg: "#fef2f2", systemPrompt: "ä½ å«ç«èŠ±ã€‚å……æ»¡åŠ¨åŠ›ã€‚", welcome: "æˆ‘æ˜¯ç«èŠ±ã€‚å‘Šè¯‰æˆ‘ä½ æœ€ä¸æ•¢é¢å¯¹çš„äº‹ã€‚" }
        };

        let currentP = null, chatHistory = [];

        function selectPersona(id) {
            currentP = personas[id];
            document.querySelectorAll('.persona-card').forEach(c => c.classList.remove('active'));
            document.getElementById(`p-${id}`).classList.add('active');
            document.body.style.backgroundColor = currentP.bg;
            document.getElementById('send').disabled = false;
            document.getElementById('chat').innerHTML = "";
            addMsg(currentP.welcome);
            chatHistory = [{ role: "assistant", content: currentP.welcome }];
        }

        function addMsg(text, isUser = false) {
            const div = document.createElement('div');
            div.className = isUser ? "bg-slate-700 text-white p-4 rounded-2xl self-end max-w-[80%]" : "bg-white p-4 rounded-2xl self-start max-w-[80%] border shadow-sm";
            div.innerText = text;
            document.getElementById('chat').appendChild(div);
            document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
        }

        async function callGemini(sys, user) {
            const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${apiKey}`;
            const payload = { contents: [{parts: [{text: user}]}], systemInstruction: {parts: [{text: sys}]} };
            try {
                const res = await fetch(url, { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(payload) });
                const data = await res.json();
                return data.candidates[0].content.parts[0].text;
            } catch(e) { return "è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥ API Key æ˜¯å¦æ­£ç¡®ã€‚"; }
        }

        document.getElementById('send').onclick = async () => {
            const input = document.getElementById('input'), val = input.value.trim();
            if(!val || !currentP) return;
            addMsg(val, true); chatHistory.push({ role: "user", content: val });
            input.value = "";
            const res = await callGemini(currentP.systemPrompt, val);
            addMsg(res);
        };

        function updateTime() {
            const now = new Date();
            document.getElementById('time').innerText = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
        }
        setInterval(updateTime, 1000); updateTime();
        lucide.createIcons();
    </script>
</body>
</html>
